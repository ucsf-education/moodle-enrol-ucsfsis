{"version":3,"file":"edit_form.min.js","sources":["../src/edit_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Form controller for the Edit Form of the UCSF SIS enrolment plugin.\n *\n * @module enrol_ucsfsis/edit_form\n */\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n  return {\n    cache: {\n      courses: {},\n      subjects: {}\n    },\n    courseId: null,\n    termId: null,\n    coursesDefaultOptionText: '',\n    subjectsDefaultOptionText: '',\n\n    $termSelect: null,\n    $subjectSelect: null,\n    $courseSelect: null,\n\n    init: function(\n      courseId,\n      termId,\n      subjects,\n      courses,\n      subjectDefaultOptionsText,\n      coursesDefaultOptionText\n    ) {\n      this.$termSelect = $('#id_selectterm');\n      this.$subjectSelect = $('#id_selectsubject');\n      this.$courseSelect = $('#id_selectcourse');\n      this.courseId = courseId;\n      this.termId = termId;\n      this.subjectsDefaultOptionText = subjectDefaultOptionsText;\n      this.coursesDefaultOptionText = coursesDefaultOptionText;\n\n      this.cacheSubjectsAndCourses(this.termId, subjects, courses);\n\n      this.$termSelect.change($.proxy(this, 'changeTerm'));\n      this.$subjectSelect.change($.proxy(this, 'changeSubject'));\n      this.enableForm();\n    },\n\n    changeSubject: function(event) {\n      var subjectId = $(event.target).find(\":selected\").val();\n      var courses = this.cache.courses[this.termId][subjectId];\n      this.repopulateSelect(this.$courseSelect, courses, this.coursesDefaultOptionText);\n    },\n\n    changeTerm: function(event) {\n      var termId = $(event.target).find(\":selected\").val();\n      var that = this;\n\n      this.disableForm();\n\n      this.termId = termId;\n\n      if (this.cache.subjects.hasOwnProperty(this.termId)) {\n        setTimeout(function() {\n          that.repopulateSelect(that.$subjectSelect, that.cache.subjects[that.termId], that.subjectsDefaultOptionText);\n          that.repopulateSelect(that.$courseSelect, [], that.coursesDefaultOptionText);\n          that.enableForm();\n        }, 500);\n      } else {\n        Ajax.call([{\n          methodname: 'enrol_ucsfsis_get_subjects_and_courses_by_term',\n          args: {courseid: this.courseId, termid: termId},\n          done: this.processResponse.bind(this, termId),\n          fail: Notification.exception\n        }]);\n      }\n    },\n\n    processResponse: function(termId, data) {\n      this.cacheSubjectsAndCourses(termId, data.subjects, data.courses);\n      this.repopulateSelect(this.$subjectSelect, data.subjects, this.subjectsDefaultOptionText);\n      this.repopulateSelect(this.$courseSelect, [], this.coursesDefaultOptionText);\n      this.enableForm();\n    },\n\n    enableForm: function() {\n      $('#id_status').prop('disabled', false);\n      this.$termSelect.prop('disabled', false);\n      this.$subjectSelect.prop('disabled', false);\n      this.$courseSelect.prop('disabled', false);\n      $('#id_roleid').prop('disabled', false);\n      $('#id_submitbutton').prop('disabled', false);\n    },\n\n    disableForm: function() {\n      $('#id_status').prop('disabled', true);\n      this.$termSelect.prop('disabled', true);\n      this.$subjectSelect.prop('disabled', true);\n      this.$courseSelect.prop('disabled', true);\n      $('#id_roleid').prop('disabled', true);\n      $('#id_submitbutton').prop('disabled', true);\n    },\n\n    repopulateSelect: function($select, options, defaultOptionTitle) {\n      $select.children().remove().end();\n      $select.append($('<option>', {\n        value: '',\n        text: defaultOptionTitle\n      }));\n      $.each(options, function(i, option) {\n        $select.append($('<option>', {\n          value: option.id,\n          text: option.title,\n        }));\n      });\n    },\n\n    cacheSubjectsAndCourses: function(termId, subjects, courses) {\n      var course, i, n;\n      this.cache.subjects[termId] = subjects;\n      this.cache.courses[termId] = {};\n\n      for (i = 0, n = courses.length; i < n; i++) {\n        course = courses[i];\n        if (!this.cache.courses[termId].hasOwnProperty(course.subjectId)) {\n          this.cache.courses[termId][course.subjectId] = [];\n        }\n        this.cache.courses[termId][course.subjectId].push(course);\n      }\n    }\n  };\n});\n"],"names":["define","$","Ajax","Notification","cache","courses","subjects","courseId","termId","coursesDefaultOptionText","subjectsDefaultOptionText","$termSelect","$subjectSelect","$courseSelect","init","subjectDefaultOptionsText","cacheSubjectsAndCourses","this","change","proxy","enableForm","changeSubject","event","subjectId","target","find","val","repopulateSelect","changeTerm","that","disableForm","hasOwnProperty","setTimeout","call","methodname","args","courseid","termid","done","processResponse","bind","fail","exception","data","prop","$select","options","defaultOptionTitle","children","remove","end","append","value","text","each","i","option","id","title","course","n","length","push"],"mappings":"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"}